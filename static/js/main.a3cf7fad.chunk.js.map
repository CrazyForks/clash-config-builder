{"version":3,"sources":["components/sharedGroup.js","components/inputDrawer.js","utils/cache.js","App.js","index.js"],"names":["items","onChange","its","map","val","className","key","uniqueId","data-id","options","group","animation","TextArea","props","title","onClose","visible","v","useState","value","setValue","useEffect","placement","width","rows","e","target","onPressEnter","type","onClick","setCache","window","localStorage","setItem","JSON","stringify","getCache","str","getItem","parse","fileDownload","require","Header","Content","Sider","Footer","RAW_CONFIG","SUB_CONFIG","PROXIES_CONFIG","RULE_TYPES","useDrawerInput","initValue","cacheKey","setVisible","t","App","rawConfig","setRawConfig","setRawDrawerVisible","subsURLs","setSubDrawerVisible","syncBtnLoading","setSyncBtnLoading","groupIndex","setGroupIndex","subProxies","setSubProxies","rawObj","setRawObj","a","urls","split","axios","url","encodeURIComponent","validateStatus","_","resps","proxies","forEach","resp","data","yml","yaml","p","concat","notification","error","message","description","stack","groups","rules","finalRules","rule","ps","trim","proxy","status","lines","l","payload","args","includes","res","filter","r","finalProxies","allProxyNames","name","g","entries","idx","obj","gs","proxyGroupNames","Item","groupProxies","length","moreProxies","theme","mode","selectedKeys","style","lineHeight","background","item","height","borderRight","padding","order","loading","icon","ReactDOM","render","document","getElementById"],"mappings":"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","file":"static/js/main.a3cf7fad.chunk.js","sourcesContent":["import React from 'react'\n\nimport Sortable from 'react-sortablejs';\nimport uniqueId from 'lodash/uniqueId';\n\nexport default function({ items = [], onChange = () => { } }) {\n  const its = items.map(val => (<div className=\"menu-item\" key={uniqueId()} data-id={val}>{val}</div>));\n\n  return (\n    <Sortable\n      options={{\n        group: 'shared',\n        animation: 150,\n      }}\n      onChange={onChange}\n      className=\"menu\"\n    >\n      {its}\n    </Sortable>\n  );\n}","import React, { useState, useEffect } from 'react'\nimport { Drawer, Input, Button } from 'antd'\n\nconst { TextArea } = Input\n\nexport default function (props) {\n    const { title = \"\", onClose = () => { }, visible = false, onChange, 'value': v } = props\n    const [value, setValue] = useState(v)\n\n    useEffect(() => {\n        setValue(v)\n    }, [v])\n\n    return (\n        <Drawer\n            title={title}\n            placement=\"right\"\n            onClose={onClose}\n            visible={visible}\n            width={\"70%\"}\n        >\n            <TextArea rows={30} onChange={(e) => setValue(e.target.value)} value={value} onPressEnter={() => { }}></TextArea>\n            <Button className=\"drawer-btn\" type=\"primary\" onClick={() => { onChange(value) }}>Save</Button>\n        </Drawer>\n    )\n}","function setCache(key, value) {\n    window.localStorage.setItem(key, JSON.stringify(value))\n}\n\nfunction getCache(key) {\n    const str = window.localStorage.getItem(key) || \"\"\n    try {\n        const obj = JSON.parse(str)\n        return obj\n    } catch{ }\n    return str\n}\n\nexport {\n    setCache,\n    getCache\n}","import React, { useState, useEffect } from 'react';\nimport { Layout, Menu, Button, notification } from 'antd'\nimport * as yaml from 'yaml'\nimport * as axios from 'axios'\n\n\nimport SharedGroup from './components/sharedGroup'\nimport RawDrawer from './components/inputDrawer'\n\nimport { setCache, getCache } from \"./utils/cache\"\n\nimport './App.css';\n\nconst fileDownload = require('react-file-download')\n\nconst { Header, Content, Sider, Footer } = Layout;\n\nconst RAW_CONFIG = \"raw\"\nconst SUB_CONFIG = \"subs\"\nconst PROXIES_CONFIG = \"proxies\"\n\nconst RULE_TYPES = [\"DOMAIN-SUFFIX\", \"DOMAIN-KEYWORD\", \"DOMAIN\", \"DOMAIN-SUFFIX\", \"IP-CIDR\", \"GEOIP\", \"FINAL\"]\n\nfunction App() {\n  const rawConfig = useDrawerInput({ title: \"Input raw config.yaml\", initValue: getCache(RAW_CONFIG) || \"\", cacheKey: RAW_CONFIG })\n  const { 'setValue': setRawConfig, 'setVisible': setRawDrawerVisible } = rawConfig\n  const subsURLs = useDrawerInput({ title: \"Input subscriptions(.yaml) url line by line\", initValue: getCache(SUB_CONFIG) || \"\", cacheKey: SUB_CONFIG })\n  const { 'setVisible': setSubDrawerVisible } = subsURLs\n  const [syncBtnLoading, setSyncBtnLoading] = useState(false)\n  const [groupIndex, setGroupIndex] = useState(\"0\")\n\n  const [subProxies, setSubProxies] = useState(getCache(PROXIES_CONFIG) || [])\n  useEffect(() => {\n    setCache(PROXIES_CONFIG, subProxies)\n  }, [subProxies])\n\n  const [rawObj, setRawObj] = useState({})\n  useEffect(() => {\n    let obj = {}\n    try {\n      obj = yaml.parse(rawConfig.value)\n    } catch{ }\n    setRawObj(obj || {})\n  }, [rawConfig.value])\n\n  async function handleSyncProxies() {\n    setSyncBtnLoading(true)\n    try {\n      const urls = subsURLs.value.split('\\n')\n      const resps = await axios.all(urls.map(url => axios.get(`https://cloudcompute.lbyczf.com/proxy-content?url=${encodeURIComponent(url)}`, {\n        validateStatus: _ => true\n      })))\n      let proxies = []\n      resps.forEach(resp => {\n        const { data = \"\" } = resp\n        let yml = {}\n        try {\n          yml = yaml.parse(data)\n        } catch{ }\n        const { 'Proxy': p = [] } = yml\n        proxies = proxies.concat(p)\n      })\n      setSubProxies(proxies)\n    } catch (e) {\n      notification.error({\n        message: \"Sync Error\",\n        description: e.stack,\n      })\n    }\n    setSyncBtnLoading(false)\n  }\n\n  function handleProxiesChange(order) {\n    if (order.length <= 0) {\n      notification.error({\n        message: \"Could not complete!\",\n        description: \"Proxy Group shold have more than one proxies.\"\n      })\n      return\n    }\n    let { 'Proxy Group': gs = [] } = rawObj\n    gs[groupIndex].proxies = order\n    const yml = yaml.stringify({ ...rawObj, 'Proxy Group': gs })\n    setRawConfig(yml)\n  }\n\n  async function handleDownloadProfile() {\n    const { 'Proxy': proxies = [], 'Proxy Group': groups = [], 'Rule': rules = [] } = rawObj\n    let finalRules = []\n    for (let rule of rules) {\n      const ps = rule.split(',').map(p => p.trim())\n      const [type, url, proxy] = ps\n      if (type === 'RULE-SET') {\n        const resp = await axios.get(url)\n        const { status, data } = resp\n        if (status === 200) {\n          const lines = data.split('\\n')\n          finalRules = [...finalRules, ...lines.map(l => {\n            const [type, payload, args] = l.split(',').map(p => p.trim())\n            if (!RULE_TYPES.includes(type)) return null;\n            let res = `${type},${payload},${proxy}`\n            if (args === 'no-resolve') {\n              res += \",no-resolve\"\n            }\n            return res\n          }).filter(r => r)]\n        }\n      } else {\n        finalRules = [...finalRules, rule]\n      }\n    }\n    const finalProxies = proxies.concat(subProxies)\n    const allProxyNames = [\n      ...finalProxies.map(p => p.name),\n      ...groups.map(g => g.name),\n      ...[\"DIRECT\", \"REJECT\", \"GLOBAL\"]\n    ]\n    for (let [idx, g] of groups.entries()) {\n      for (let ps of g.proxies) {\n        if (!allProxyNames.includes(ps)) {\n          notification.error({\n            message: \"Proxy Missing\",\n            description: `Group [${g.name}] contains a not exist proxy [${ps}]`,\n          })\n          setGroupIndex(idx + \"\")\n          return \n        }\n      }\n    }\n    fileDownload(yaml.stringify({ ...rawObj, 'Proxy': finalProxies, 'Rule': finalRules }), 'config.yaml')\n  }\n\n  const { 'Proxy Group': gs = [], 'Proxy': ps = [] } = rawObj\n  const proxyGroupNames = gs.map((g, idx) => {\n    return (\n      <Menu.Item key={idx}>{g.name}</Menu.Item>\n    )\n  })\n\n  let groupProxies = []\n  if (groupIndex < gs.length) {\n    groupProxies = gs[groupIndex * 1].proxies\n  }\n\n  const moreProxies = [\n    'DIRECT',\n    'GLOBAL',\n    'REJECT',\n    ...gs.map(g => g.name),\n    ...ps.map(p => p.name),\n    ...subProxies.map(p => p.name)\n  ].filter(p => {\n    return !groupProxies.includes(p)\n  })\n\n  return (\n    <Layout className=\"main\">\n      <Header className=\"header\">\n        <div className=\"logo\" />\n        <Menu\n          theme=\"dark\"\n          mode=\"horizontal\"\n          selectedKeys={['1']}\n          style={{ lineHeight: '64px' }}\n        >\n          <Menu.Item key=\"1\">Proxy Group</Menu.Item>\n          <Menu.Item key=\"2\" onClick={() => setRawDrawerVisible(true)}>Raw Config.yaml</Menu.Item>\n          <Menu.Item key=\"3\" onClick={() => setSubDrawerVisible(true)}>Subscription</Menu.Item>\n        </Menu>\n      </Header>\n      <Layout>\n        <Sider width={200} style={{ background: '#fff' }}>\n          <Menu\n            mode=\"inline\"\n            selectedKeys={[groupIndex]}\n            onClick={(item) => setGroupIndex(item.key)}\n            style={{ height: '100%', borderRight: 0 }}\n          >\n            {proxyGroupNames}\n          </Menu>\n        </Sider>\n        <Layout style={{ padding: '0 24px 24px' }}>\n          <Content\n            className=\"content\"\n          >\n            <div className=\"list\">\n              <div className=\"list-title\">Proxies</div>\n              <SharedGroup\n                items={groupProxies}\n                onChange={handleProxiesChange}\n              />\n            </div>\n\n            <div className=\"list\">\n              <div className=\"list-title\">More</div>\n              <SharedGroup\n                items={moreProxies}\n                onChange={() => { }}\n              />\n            </div>\n\n          </Content>\n        </Layout>\n      </Layout>\n      <Footer className=\"footer\">\n        <Button className=\"btn\" loading={syncBtnLoading} icon=\"cloud-download\" onClick={handleSyncProxies}>Sync Proxies</Button>\n        <Button className=\"btn\" type=\"primary\" icon=\"download\" onClick={handleDownloadProfile}>Download Profile</Button>\n      </Footer>\n      <RawDrawer\n        {...rawConfig}\n      ></RawDrawer>\n      <RawDrawer\n        {...subsURLs}\n      ></RawDrawer>\n    </Layout>\n  );\n}\n\n\nfunction useDrawerInput({ title, initValue, cacheKey }) {\n  const [value, setValue] = useState(initValue)\n  const [visible, setVisible] = useState(false)\n\n  useEffect(() => {\n    if (cacheKey) {\n      setCache(cacheKey, value)\n    }\n  })\n\n  function handleChange(t) {\n    setVisible(false)\n    setValue(t)\n  }\n\n  return {\n    title,\n    visible,\n    value,\n    onClose: () => setVisible(false),\n    onChange: handleChange,\n    setValue,\n    setVisible,\n  }\n}\n\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\n// import * as serviceWorker from './serviceWorker';\n\nReactDOM.render(<App />, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\n// serviceWorker.unregister();\n"],"sourceRoot":""}